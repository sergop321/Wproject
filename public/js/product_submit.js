// Generated by CoffeeScript 1.6.3
$(function() {
  var autocomplete, counter, defaultBounds, input, load_sub_categories, options, print_error;
  window.product = {
    product: {
      prod_name: "אייפון 5",
      prod_category: "electronic_products",
      prod_sub_category: "phones",
      prod_adress: "השוקן 18, תל אביב",
      prod_phone: "05477712383",
      prod_price: "70",
      prod_deposit: "20",
      prod_details: "מעוניין להשכיר רק לאזור המרכז"
    },
    is_show_phone: 1,
    extra_details: {
      power: {
        name: "הספק",
        val: "200 wat"
      },
      operation_system: {
        name: "מערכת הפעלה",
        val: "ios7"
      }
    }
  };
  window.categories = {
    electric_products: {
      washing_machines: "מכונות כביסה",
      ovens: "תנורים",
      mixers: "מיקסרים"
    },
    electronic_products: {
      phones: "פאלפונים",
      tvs: "טלוויזיות"
    },
    clothes: {
      women_clothes: "בגדי נשים",
      men_clothes: "בגדי גברים",
      wedding_dresses: "שמלאות כלה"
    }
  };
  counter = 0;
  load_sub_categories = function(category) {
    if (categories === null || typeof categories === 'undefined' || _.isEmpty(categories) || _.isEmpty(categories[category])) {
      return print_error("קטגוריה לא מזוהה");
    } else {
      $("#prod_sub_category").html('<option value="" style="display:none;"></option>');
      $("#prod_sub_category").removeAttr("disabled");
      return _(categories[category]).each(function(category_name, category_val) {
        return $("#prod_sub_category").append("<option value='" + category_val + "'>" + category_name + "</option>");
      });
    }
  };
  print_error = function(error_text) {
    var error;
    error = '<div class="alert alert-error">' + error_text + '	\n	<button type="button" class="close" data-dismiss="alert">&times;</button>\n</div>';
    return $("#errors").append(error);
  };
  $("#technical_details").change(function() {
    var text;
    if ($(this).val() !== null && $(this).val() !== "" && $(this).val() !== " ") {
      if ($("#prod_detail_" + ($(this).val())).length > 0) {
        return print_error("כבר בחרת את האפשרות הזאת");
      } else {
        text = '<div class="tech_detail" id="detail_' + counter + '" style="display:none">\n<label class="control-label" for="prod_detail_' + $(this).val() + '">' + $("#technical_details option:selected").text() + '</label>\n<input type="text" name="prod_detail_' + $(this).val() + '" id="prod_detail_' + $(this).val() + '" class="span2"/>\n	<i class="icon-remove"></i>\n	<div  class="clear"></div>\n</div>';
        $("#tech_details").append(text);
        $("#detail_" + counter).show("slow");
        return counter++;
      }
    }
  });
  $("#submit_product").click(function() {
    var data;
    $(this).button('loading');
    data = $("form").serialize();
    return $(this).button('complete');
  });
  $('#tech_details').on("click", ".icon-remove", function() {
    return $(this).parent().hide("slow", function() {
      return $(this).remove();
    });
  });
  $('#prod_category').change(function() {
    if ($(this).val() !== "") {
      return load_sub_categories($(this).val());
    } else {
      return $("#prod_sub_category").attr("disabled", "disabled");
    }
  });
  if ((typeof product !== "undefined" && product !== null) && !_.isEmpty(product)) {
    if (product.product != null) {
      _(product.product).each(function(product_name, product_val) {
        if (product_val === "prod_category" || product_val === "prod_sub_category") {
          $("#" + product_val + " option[value=" + product_name + "]").attr("selected", "selected");
          if (product_val === "prod_category") {
            return load_sub_categories(product_name);
          }
        } else {
          return $("#" + product_val).val(product_name);
        }
      });
    }
    if (product.is_show_phone != null) {
      if (product.is_show_phone === 1 || product.is_show_phone === "1") {
        $("#show_phone").prop("checked", true);
      }
    }
    if ((product.extra_details != null) && !_.isEmpty(product.extra_details)) {
      _(product.extra_details).each(function(product_prop, product_val) {
        var text;
        text = '<div class="tech_detail" id="detail_' + counter + '" style="display:none">\n<label class="control-label" for="prod_detail_' + product_val + '">' + product_prop.name + '</label>\n<input type="text" name="prod_detail_' + product_val + '" id="prod_detail_' + product_val + '" class="span2" value="' + product_prop.val + '"/>\n	<i class="icon-remove"></i>\n	<div  class="clear"></div>\n</div>';
        $("#tech_details").append(text);
        $("#detail_" + counter).show("slow");
        return counter++;
      });
    }
  }
  defaultBounds = new google.maps.LatLngBounds(new google.maps.LatLng(32.066158, 34.777819));
  input = document.getElementById("prod_adress");
  options = {
    bounds: defaultBounds
  };
  return autocomplete = new google.maps.places.Autocomplete(input, options);
});
